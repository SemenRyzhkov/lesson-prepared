### Индексирование больших таблиц

Есть большая таблица, хотим накатить на нее индекс. Обычный create index блокирует таблицу на время
создания индекса. В случае таблиц с сотнями миллионами строк длительность создания индекса может достигать часа.
В это время все пишущие запросы будут падать с lock timeout из-за невозможности взятия блокировки
=> сервис начнет пятисотить => фактически получаем даунтайм.

### Решение

Использовать конструкцию create index concurrently. Она позволяет создать индекс, не блокируя пишущие запросы, 
однако создание индекса в таком режиме занимает существенно больше времени.

Пример: хотим накатить следующий индекс

```sql
create index idx__big_table__column
    on big_table(column);
```

Для этого перед деплоем приложения руками делаем

```sql
create index concurrently idx__big_table__column
    on big_table(column);
```

И в файле миграции пишем

```sql
create index if not exist idx__big_table__column
    on big_table(column);
```

Смысл накатывания индекса руками в том, что инструменты для миграции схемы БД обычно применяют миграции синхронно, 
что при деплое приложения заставило бы ждать существенное время.




